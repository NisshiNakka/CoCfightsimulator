<%= turbo_stream.update "dice_result" do %>
  <div class="card shadow-sm border-secondary mb-4">
    <div class="card-header bg-secondary text-white fw-bold">
      <i class="bi bi-clock-history me-2"></i><%= t('.title') %>
    </div>

    <div class="card-body bg-light-subtle">
      <div class="row row-cols-1 g-3">
        <% @sorted_results.each do |result| %>
          <div class="col">
            <% is_ally = result[:side] == :ally %>
            <div class="alert <%= is_ally ? 'alert-success' : 'alert-danger' %> border-start border-4 mb-0 shadow-sm">
              <h5 class="fw-bold h6">
                <i class="bi <%= is_ally ? 'bi-shield-shaded' : 'bi-exclamation-triangle-fill' %> me-2"></i>
                <%= result[:attacker_name] %><%= t('.to_attack') %>
              </h5>
              <p class="mb-1 small">【<%= t(".status.#{result[:status]}") %>】</p>
              <small class="d-block text-body-secondary">
              <%= t(".messages.#{result[:status]}", 
                      attacker: result[:attacker_name],
                      defender: result[:defender_name],
                      attack_text: result[:attack_text],
                      evasion_text: result[:evasion_text],
                      damage_text: result[:damage_text],
                      remaining_hp: result[:remaining_hp]
                    ).html_safe %>
              </small>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>